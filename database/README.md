# 客户管理系统数据库初始化说明

本目录包含客户管理系统所需的数据库表结构和权限设置SQL脚本。

## 文件说明

- `init.sql`: 完整的数据库初始化脚本，包含所有表结构、索引、权限和触发器的定义
- `schema.sql`: 仅包含表结构和索引定义的脚本
- `security.sql`: 仅包含安全策略和权限设置的脚本

## 使用方法

### 方法一：使用Supabase界面导入

1. 登录Supabase管理控制台
2. 进入SQL编辑器
3. 创建新查询，复制粘贴`init.sql`的内容
4. 点击运行按钮执行SQL脚本

### 方法二：使用psql命令行工具导入

```bash
psql -h <supabase_host> -U <supabase_user> -d <database_name> -f init.sql
```

## 表结构说明

### 用户角色表 (user_roles)

存储系统用户的角色信息，定义用户在系统中的权限级别。

### 客户表 (customers)

存储客户的基本信息和状态，包括个人信息、电站参数、施工状态等。

### 修改记录表 (modification_records)

记录客户信息的修改历史，用于追踪数据变更。

### 抽签记录表 (draw_records)

记录客户抽签选择施工队的结果，用于实现公平、透明的施工队选择机制。

## 权限说明

系统定义了以下角色及其权限：

- **管理员(admin)**: 可以查看和修改所有数据
- **业务员(salesman)**: 只能查看和修改自己的客户
- **仓库管理员(warehouse)**: 可以查看所有客户，但只能更新出库相关字段
- **施工队(construction_team)**: 只能查看分配给自己的客户，并更新施工状态
- **备案员(filing_officer)**: 可以查看所有客户，但只能更新备案相关字段
- **并网员(grid_connector)**: 可以查看所有客户，但只能更新并网相关字段

## 行级安全策略

系统使用PostgreSQL的行级安全策略(RLS)来控制不同角色用户对数据的访问权限，确保数据安全和隔离。